{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport Link from 'next/link';\nimport Button from 'components/Button/Button';\nimport RadioCard from 'components/RadioCard/RadioCard';\nimport RadioGroup from 'components/RadioGroup/RadioGroup';\nimport PaymentGroup from 'components/PaymentGroup/PaymentGroup';\nimport Loader from 'components/Loader/Loader';\nimport UpdateContact from '../Checkout/Update/UpdateContact';\nimport UpdateAddress from '../Checkout/Update/UpdateAddress';\nimport StripePaymentForm from '../Payment/StripePaymentForm';\nimport { DELETE_ADDRESS } from 'graphql/mutation/address';\nimport { DELETE_CARD } from 'graphql/mutation/card';\nimport { DELETE_CONTACT } from 'graphql/mutation/contact';\nimport { CURRENCY } from 'helper/constant';\nimport { openModal } from '@redq/reuse-modal';\nimport { useMutation } from '@apollo/react-hooks';\nimport { Scrollbars } from 'react-custom-scrollbars';\nimport CheckoutWrapper, { CheckoutContainer, CheckoutInformation, InformationBox, DeliverySchedule, Heading, ButtonGroup, CheckoutSubmit, HaveCoupon, CouponBoxWrapper, CouponInputBox, Input, CouponCode, RemoveCoupon, ErrorMsg, TermConditionText, TermConditionLink, CartWrapper, CalculationWrapper, OrderInfo, Title, ItemsWrapper, Items, Quantity, Multiplier, ItemInfo, Price, TextWrapper, Text, Bold, Small, NoProductMsg } from './CheckoutWithSidebar.style';\nimport { Plus } from 'components/AllSvgIcon';\nimport Sticky from 'react-stickynode';\nimport { HeaderContext } from 'contexts/header/header.context';\nimport { ProfileContext } from 'contexts/profile/profile.context';\nimport { FormattedMessage } from 'react-intl';\nimport { useCart } from 'contexts/cart/use-cart';\nimport { APPLY_COUPON } from 'graphql/mutation/coupon';\nimport { useLocale } from 'contexts/language/language.provider'; // import { getLocalState } from 'helper/localStorage';\n// The type of props Checkout Form receives\n\nconst OrderItem = ({\n  product\n}) => {\n  const {\n    id,\n    quantity,\n    title,\n    unit,\n    price,\n    salePrice\n  } = product;\n  const displayPrice = salePrice ? salePrice : price;\n  return __jsx(Items, {\n    key: id\n  }, __jsx(Quantity, null, quantity), __jsx(Multiplier, null, \"x\"), __jsx(ItemInfo, null, title, \" | \", unit !== null && unit !== void 0 ? unit : ''), __jsx(Price, null, CURRENCY, (displayPrice * quantity).toFixed(2)));\n};\n\nconst CheckoutWithSidebar = ({\n  deviceType\n}) => {\n  const {\n    0: hasCoupon,\n    1: setHasCoupon\n  } = useState(false);\n  const {\n    0: couponCode,\n    1: setCouponCode\n  } = useState('');\n  const {\n    0: couponError,\n    1: setError\n  } = useState('');\n  const {\n    state,\n    dispatch\n  } = useContext(ProfileContext);\n  const {\n    isRtl\n  } = useLocale();\n  const {\n    items,\n    removeCoupon,\n    coupon,\n    applyCoupon,\n    clearCart,\n    cartItemsCount,\n    calculatePrice,\n    calculateDiscount,\n    calculateSubTotalPrice\n  } = useCart();\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: isValid,\n    1: setIsValid\n  } = useState(false);\n  const {\n    address,\n    contacts,\n    cards,\n    schedules\n  } = state;\n  const [deleteContactMutation] = useMutation(DELETE_CONTACT);\n  const [deleteAddressMutation] = useMutation(DELETE_ADDRESS);\n  const [deletePaymentCardMutation] = useMutation(DELETE_CARD);\n  const [appliedCoupon] = useMutation(APPLY_COUPON);\n  const {\n    headerState\n  } = useContext(HeaderContext);\n  const totalHeight = (headerState === null || headerState === void 0 ? void 0 : headerState.desktopHeight) > 0 ? headerState.desktopHeight + 30 : 76 + 30;\n\n  const handleSubmit = async () => {\n    setLoading(true);\n\n    if (isValid) {\n      console.log(items, address, contacts, cards, schedules);\n      clearCart();\n      Router.push('/order-received');\n    }\n\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    if (calculatePrice() > 0 && cartItemsCount > 0 && address.length && contacts.length && cards.length && schedules.length) {\n      setIsValid(true);\n    }\n  }, [state]); // Add or edit modal\n\n  const handleModal = (modalComponent, modalProps = {}, className = 'add-address-modal') => {\n    openModal({\n      show: true,\n      config: {\n        width: 360,\n        height: 'auto',\n        enableResizing: false,\n        disableDragging: true,\n        className: className\n      },\n      closeOnClickOutside: true,\n      component: modalComponent,\n      componentProps: {\n        item: modalProps\n      }\n    });\n  };\n\n  const handleEditDelete = async (item, type, name) => {\n    if (type === 'edit') {\n      const modalComponent = name === 'address' ? UpdateAddress : UpdateContact;\n      handleModal(modalComponent, item);\n    } else {\n      // console.log(name, item, type, 'delete');\n      switch (name) {\n        case 'payment':\n          dispatch({\n            type: 'DELETE_CARD',\n            payload: item.id\n          });\n          return await deletePaymentCardMutation({\n            variables: {\n              slug: item.slug\n            }\n          });\n\n        case 'contact':\n          dispatch({\n            type: 'DELETE_CONTACT',\n            payload: item.id\n          });\n          return await deleteContactMutation({\n            variables: {\n              slug: item.slug\n            }\n          });\n\n        case 'address':\n          dispatch({\n            type: 'DELETE_ADDRESS',\n            payload: item.id\n          });\n          return await deleteAddressMutation({\n            variables: {\n              slug: item.slug\n            }\n          });\n\n        default:\n          return false;\n      }\n    }\n  };\n\n  const handleApplyCoupon = async () => {\n    const {\n      data\n    } = await appliedCoupon({\n      variables: {\n        code: couponCode\n      }\n    });\n\n    if (data.applyCoupon && data.applyCoupon.discountInPercent) {\n      applyCoupon(data.applyCoupon);\n      setCouponCode('');\n    } else {\n      setError('Invalid Coupon');\n    }\n  };\n\n  const handleOnUpdate = couponCode => {\n    setCouponCode(couponCode);\n  };\n\n  return __jsx(\"form\", null, __jsx(CheckoutWrapper, null, __jsx(CheckoutContainer, null, __jsx(CheckoutInformation, null, __jsx(InformationBox, null, __jsx(Heading, null, __jsx(FormattedMessage, {\n    id: \"checkoutDeliveryAddress\",\n    defaultMessage: \"Delivery Address\"\n  })), __jsx(ButtonGroup, null, __jsx(RadioGroup, {\n    items: address,\n    component: item => __jsx(RadioCard, {\n      id: item.id,\n      key: item.id,\n      title: item.name,\n      content: item.info,\n      name: \"address\",\n      checked: item.Type === 'primary',\n      onChange: () => dispatch({\n        type: 'SET_PRIMARY_ADDRESS',\n        payload: item.id.toString()\n      }),\n      onEdit: () => handleEditDelete(item, 'edit', 'address'),\n      onDelete: () => handleEditDelete(item, 'delete', 'address')\n    }),\n    secondaryComponent: __jsx(Button, {\n      className: \"addButton\",\n      title: \"Add New\",\n      icon: __jsx(Plus, {\n        width: \"10px\"\n      }),\n      iconPosition: \"left\",\n      colors: \"primary\",\n      size: \"small\",\n      variant: \"textButton\",\n      type: \"button\",\n      intlButtonId: \"addNew\",\n      onClick: () => handleModal(UpdateAddress, 'add-address-modal')\n    })\n  }))), __jsx(InformationBox, null, __jsx(DeliverySchedule, null, __jsx(Heading, null, __jsx(FormattedMessage, {\n    id: \"deliverySchedule\",\n    defaultMessage: \"Select Your Delivery Schedule\"\n  })), __jsx(RadioGroup, {\n    items: schedules,\n    component: item => __jsx(RadioCard, {\n      id: item.id,\n      key: item.id,\n      title: item.title,\n      content: item.time_slot,\n      name: \"schedule\",\n      checked: item.Type === 'primary',\n      withActionButtons: false,\n      onChange: () => dispatch({\n        type: 'SET_PRIMARY_SCHEDULE',\n        payload: item.id.toString()\n      })\n    })\n  }))), __jsx(InformationBox, null, __jsx(Heading, null, __jsx(FormattedMessage, {\n    id: \"contactNumberText\",\n    defaultMessage: \"Select Your Contact Number\"\n  })), __jsx(ButtonGroup, null, __jsx(RadioGroup, {\n    items: contacts,\n    component: item => __jsx(RadioCard, {\n      id: item.id,\n      key: item.id,\n      title: item.Type,\n      content: item.number,\n      checked: item.Type === 'primary',\n      onChange: () => dispatch({\n        type: 'SET_PRIMARY_CONTACT',\n        payload: item.id.toString()\n      }),\n      name: \"contact\",\n      onEdit: () => handleEditDelete(item, 'edit', 'contact'),\n      onDelete: () => handleEditDelete(item, 'delete', 'contact')\n    }),\n    secondaryComponent: __jsx(Button, {\n      title: \"Add Contact\",\n      icon: __jsx(Plus, {\n        width: \"10px\"\n      }),\n      iconPosition: \"left\",\n      colors: \"primary\",\n      size: \"small\",\n      variant: \"outlined\",\n      type: \"button\",\n      intlButtonId: \"addContactBtn\",\n      onClick: () => handleModal(UpdateContact, 'add-contact-modal')\n    })\n  }))), __jsx(InformationBox, {\n    className: \"paymentBox\",\n    style: {\n      paddingBottom: 30\n    }\n  }, __jsx(Heading, null, __jsx(FormattedMessage, {\n    id: \"selectPaymentText\",\n    defaultMessage: \"Select Payment Option\"\n  })), __jsx(PaymentGroup, {\n    name: \"payment\",\n    deviceType: deviceType,\n    items: cards,\n    onEditDeleteField: (item, type) => handleEditDelete(item, type, 'payment'),\n    onChange: item => dispatch({\n      type: 'SET_PRIMARY_CARD',\n      payload: item.id.toString()\n    }),\n    handleAddNewCard: () => {\n      handleModal(StripePaymentForm, {\n        totalPrice: calculatePrice()\n      }, 'add-address-modal stripe-modal');\n    }\n  }), coupon ? __jsx(CouponBoxWrapper, null, __jsx(CouponCode, null, __jsx(FormattedMessage, {\n    id: \"couponApplied\"\n  }), __jsx(\"span\", null, coupon.code), __jsx(RemoveCoupon, {\n    onClick: e => {\n      e.preventDefault();\n      removeCoupon();\n      setHasCoupon(false);\n    }\n  }, __jsx(FormattedMessage, {\n    id: \"removeCoupon\"\n  })))) : __jsx(CouponBoxWrapper, null, !hasCoupon ? __jsx(HaveCoupon, {\n    onClick: () => setHasCoupon(prev => !prev)\n  }, __jsx(FormattedMessage, {\n    id: \"specialCode\",\n    defaultMessage: \"Have a special code?\"\n  })) : __jsx(React.Fragment, null, __jsx(CouponInputBox, null, __jsx(Input, {\n    onUpdate: handleOnUpdate,\n    value: couponCode,\n    intlPlaceholderId: \"couponPlaceholder\"\n  }), __jsx(Button, {\n    onClick: handleApplyCoupon,\n    title: \"Apply\",\n    intlButtonId: \"voucherApply\"\n  })), couponError && __jsx(ErrorMsg, null, __jsx(FormattedMessage, {\n    id: \"couponError\",\n    defaultMessage: couponError\n  })))), __jsx(TermConditionText, null, __jsx(FormattedMessage, {\n    id: \"termAndConditionHelper\",\n    defaultMessage: \"By making this purchase you agree to our\"\n  }), __jsx(Link, {\n    href: \"#\"\n  }, __jsx(TermConditionLink, null, __jsx(FormattedMessage, {\n    id: \"termAndCondition\",\n    defaultMessage: \"terms and conditions.\"\n  })))), __jsx(CheckoutSubmit, null, __jsx(Button, {\n    onClick: handleSubmit,\n    type: \"button\",\n    disabled: !isValid,\n    title: \"Proceed to Checkout\",\n    intlButtonId: \"proceesCheckout\",\n    loader: __jsx(Loader, null),\n    isLoading: loading\n  })))), __jsx(CartWrapper, null, __jsx(Sticky, {\n    enabled: true,\n    top: totalHeight,\n    innerZ: 999\n  }, __jsx(OrderInfo, null, __jsx(Title, null, __jsx(FormattedMessage, {\n    id: \"cartTitle\",\n    defaultMessage: \"Your Order\"\n  })), __jsx(Scrollbars, {\n    universal: true,\n    autoHide: true,\n    autoHeight: true,\n    autoHeightMax: \"390px\",\n    renderView: props => __jsx(\"div\", _extends({}, props, {\n      style: _objectSpread(_objectSpread({}, props.style), {}, {\n        marginLeft: isRtl ? props.style.marginRight : 0,\n        marginRight: isRtl ? 0 : props.style.marginRight,\n        paddingLeft: isRtl ? 15 : 0,\n        paddingRight: isRtl ? 0 : 15\n      })\n    }))\n  }, __jsx(ItemsWrapper, null, cartItemsCount > 0 ? items.map(item => __jsx(OrderItem, {\n    key: `cartItem-${item.id}`,\n    product: item\n  })) : __jsx(NoProductMsg, null, __jsx(FormattedMessage, {\n    id: \"noProductFound\",\n    defaultMessage: \"No products found\"\n  })))), __jsx(CalculationWrapper, null, __jsx(TextWrapper, null, __jsx(Text, null, __jsx(FormattedMessage, {\n    id: \"subTotal\",\n    defaultMessage: \"Subtotal\"\n  })), __jsx(Text, null, CURRENCY, calculateSubTotalPrice())), __jsx(TextWrapper, null, __jsx(Text, null, __jsx(FormattedMessage, {\n    id: \"intlOrderDetailsDelivery\",\n    defaultMessage: \"Delivery Fee\"\n  })), __jsx(Text, null, CURRENCY, \"0.00\")), __jsx(TextWrapper, null, __jsx(Text, null, __jsx(FormattedMessage, {\n    id: \"discountText\",\n    defaultMessage: \"Discount\"\n  })), __jsx(Text, null, CURRENCY, calculateDiscount())), __jsx(TextWrapper, {\n    style: {\n      marginTop: 20\n    }\n  }, __jsx(Bold, null, __jsx(FormattedMessage, {\n    id: \"totalText\",\n    defaultMessage: \"Total\"\n  }), ' ', __jsx(Small, null, \"(\", __jsx(FormattedMessage, {\n    id: \"vatText\",\n    defaultMessage: \"Incl. VAT\"\n  }), \")\")), __jsx(Bold, null, CURRENCY, calculatePrice())))))))));\n};\n\nexport default CheckoutWithSidebar;","map":null,"metadata":{},"sourceType":"module"}